<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        header {
            text-align: center;
        }

        main {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #smt_btn {
            width: 100%;
        }

        #journey_type {
            width: 100%;
        }
    </style>
</head>

<body>
    <header>
        <h1>
            Flight Booker
        </h1>
    </header>
    <main>
        <form action="">
            <select name="journey_type" id="journey_type">
                <option value="one_way_flight">One-way-flight</option>
                <option value="return_flight">return-flight</option>
            </select>
            <br>
            <input type="text" id="departure_date" placeholder="departure date">
            <br>
            <input type="text" id="return_date" placeholder="return date" disabled>
            <br>
            <input type="submit" value="Book" id="smt_btn">
        </form>
    </main>

    <script>
        let dt = new Date().toLocaleDateString()
        let slt_elem = document.getElementById("journey_type")
        let dep_inp = document.getElementById("departure_date")
        let retn_ip = document.getElementById("return_date")
        let smt_btn = document.getElementById("smt_btn")
        let dep_inp_bool = 0;
        let retn_inp_bool = 1;
        dt_arr = dt.split("/")
        let curr_date = dt_arr.join(".")
        dep_inp.value = curr_date
        let curr_year = dt_arr[2]
        let curr_mnt = dt_arr[1]
        let curr_day = dt_arr[0]



        slt_elem.addEventListener("change", () => {
            retn_ip.disabled = !retn_ip.disabled
            if (slt_elem.value === "one_way_flight") {
                retn_ip.value = ""
                if (!dep_inp_bool) {
                    smt_btn.disabled = false;
                } else smt_btn.disabled = true;
            } else if (dep_inp_bool == 0 && retn_inp_bool == 0) {
                smt_btn.disabled = false
            } else smt_btn.disabled = true
        })


        dep_inp.addEventListener("input", () => {

            if (!validation(dep_inp)) {
                dep_inp_bool = 1;
                return;
            }
            dep_inp.style.borderColor = "black"
            dep_inp_bool = 0;
            smt_btn.disabled = false
        })



        retn_ip.addEventListener("input", () => {
            if (!validation(retn_ip)) {
                // if compare date
                retn_inp_bool = 1;
                return;
            }
            retn_ip.style.borderColor = "black"
            retn_inp_bool = 0;
            if (dep_inp_bool) return;

            let dep_arr = dep_inp.value.split(".")
            dep_arr.reverse()
            let dep_date = new Date(parseInt(dep_arr[0]),parseInt(dep_arr[1]-1),parseInt(dep_arr[2]))
            let retn_arr = retn_ip.value.split(".")
            retn_arr.reverse()
            let rtn_date = new Date(parseInt(retn_arr[0]),parseInt(retn_arr[1]-1),parseInt(retn_arr[2]))
            

            if (dep_date>rtn_date) {
                throw_err(retn_arr)
                retn_inp_bool = 1
            }
            smt_btn.disabled=false
            retn_inp_bool = 0
        })



        function is_leap_year(year) {
            if (year % 4 == 0) {
                if (year % 100 == 0) {
                    return year % 400 == 0
                }
                return 1
            }
            return 0;
        }
        function throw_err(elem) {
            elem.style.borderColor = "red"
            smt_btn.disabled = true
            console.log("error")
        }



        function validation(elem) {
            let date_arr = elem.value.split(".")
            let last_ind = date_arr.length - 1
            let str_length = date_arr[last_ind].length
            if ((date_arr[last_ind][str_length - 1] > "9" || date_arr[last_ind][str_length - 1] < "0") && (date_arr[last_ind][str_length - 1] != '.') || (date_arr.length != 3)) {
                // throw error
                throw_err(elem)
                return 0
            }
            if(date_arr[last_ind]==""){
                throw_err(elem)
                return 0;
            }
            let year = parseInt(date_arr[2])
            let mnt = parseInt(date_arr[1])
            let day = parseInt(date_arr[0])
            let isly = is_leap_year(year)
            let islm = (is_leap_year(year) && (mnt == 2))
            let mnth_31 = [1, 3, 5, 7, 8, 10, 12]
            if (year == 0 || mnt == 0 || day == 0 || mnt > 12 || day > 31) {
                throw_err(elem)
                return 0
            }
            if (year < curr_year) {
                throw_err(elem)
                return 0
            }

            if (year == curr_year && mnt < curr_mnt) {
                throw_err(elem)
                return 0
            }
            if (year == curr_year && mnt == curr_mnt && day < curr_day) {
                throw_err(elem)
                return 0
            }
            if (islm && day > 29) {
                throw_err(elem)
                return 0
            }
            if (mnt == 2 && day > 28) {
                throw_err(elem)
                return 0
            }

            let is_31 = 0
            for (let i = 0; i < 7; i++) {
                if (mnt == mnth_31[i]) {
                    is_31 = 1;
                    break;
                }
            }

            if (!is_31 && day > 30) {
                throw_err(elem)
                return 0
            }
            return 1
        }









    </script>
</body>

</html>